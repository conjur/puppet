- !policy
  id: inventory
  annotations:
    description: Policy that governs access to the inventory database
  body:
    - !variable &db-password db-password

    - !layer
    - !host-factory
      layers: [ !layer ]

    - !permit
      role: [ !layer ]
      resource: *db-password
      privilege: [ read, execute ]

    - !host &h_agent_apikey
      id: /agent-apikey-node
      annotations:
        puppet: true

    - !host &h_hiera_apikey
      id: /hiera-apikey-node
      annotations:
        puppet: true

    - !host &h_manifest_apikey
      id: /manifest-apikey-node
      annotations:
        puppet: true

    # Vagrant test node
    - !host &h_node01
      id: /node01
      annotations:
        puppet: true

    - !grant
      role: !layer
      members:
        - *h_agent_apikey
        - *h_hiera_apikey
        - *h_manifest_apikey
        - *h_node01
